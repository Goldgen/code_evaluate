<!DOCTYPE html>
<!-- saved from url=(0039)https://leetcode-cn.com/problemset/all/ -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


    <title>题库维护</title>


    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
          name="viewport">


    #include("_css.html")
    <link rel="stylesheet" href="/statics/css/test_db.css" type="text/css">
    <style>
        .btn-default {
            color: #333;
            background-color: #fff;
            border-color: #ccc0;
        }

        .btn-default:hover {
            background-color: #e6e6e6;
            border-color: #ccc0;
        }

        .open > .dropdown-toggle.btn-default:focus, .open > .dropdown-toggle.btn-default:hover {
            background-color: #e6e6e6;
            border-color: #ccc0;
        }
    </style>
</head>
<body>

#include("_navbar.html")


<div class="container main">
    <!-- end scroll_to_top_button -->
    <div class="row" id="category-app"></div>


    <div class="row">
        <div class="col-md-9 blog-main">
            <div class="row" id="question-app">
                <div>
                    <div>
                        <div class="question-list-base">
                            <input type="hidden" id="topicId" value="-1">
                            <input type="hidden" id="difficulty" value="-1">
                            <input type="hidden" id="content" value="-1">
                            <input type="hidden" id="courseId" value="-1">
                            <div class="question-filter-base">
                                <div class="separator-line question-filter-hr">
                                    <div class="separator-op"></div>
                                    <div class="separator_left_mask"></div>
                                    <div class="separator_right_mask"></div>
                                </div>
                                <div class="row search-bar-control">
                                    <div class="col-sm-6 col-lg-7">
                                        <input type="text" class="form-control list-search-bar"
                                               placeholder="搜索题目 包括名称、内容" value="">
                                    </div>
                                    <div class="pull-right dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button"
                                                id="knowledge-point-dropdown"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                            知识点
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="knowledge-point-dropdown">
                                            #for(topic : topicList)
                                            <li><a class="filter" data-ref="topicId" data-id="#(topic.topicId)"
                                                   href="#">【#escape(topic.topicName)】</a>
                                            </li>
                                            #end
                                        </ul>
                                    </div>
                                    <div class="pull-right dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button"
                                                id="course-dropdown"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                            课程
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="course-dropdown">
                                            #for(course : courseList)
                                            <li><a class="filter" data-ref="courseId" data-id="#(course.courseId)"
                                                   href="#">【#escape(course.courseName)】</a></li>
                                            #end
                                        </ul>
                                    </div>
                                    <div class="pull-right dropdown">
                                        <button class="btn btn-default dropdown-toggle" type="button"
                                                id="difficulty-dropdown"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                            难度
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="difficulty-dropdown">
                                            <li><a class="filter" data-ref="difficulty" data-id="3" href="#">简单</a></li>
                                            <li><a class="filter" data-ref="difficulty" data-id="2" href="#">中等</a></li>
                                            <li><a class="filter" data-ref="difficulty" data-id="1" href="#">困难</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="row ">
                                    <div class="col-xs-12">
                                        <div class="filter-tag-bar">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="main-table">

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 blog-sidebar">
            <div class="col-md-offset-5 col-md-10">
                <button class="btn btn-primary add-test-btn" style="margin-top: 20px">新增題目</button>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="testModel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">新增题目</h4>
            </div>
            <form class="form-horizontal" id="test-form" method="post" action="/testDb/addTest">
                <div class="modal-body">
                    <input type="hidden" name="testId" id="testIdForModel" value="0">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">题目内容</label>
                        <div class="col-sm-5">
                            <input class="form-control" name="testName" id="testNameForModel"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">题目内容</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" rows="6" name="content" id="testContentForModel"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">知识点</label>
                        <div class="col-sm-5">
                            <select class="form-control" name="topicId" id="topicIdForModel">
                                #for(topic : topicList)
                                <option value="#(topic.topicId)">【#escape(topic.topicName)】</option>
                                #end
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">课程</label>
                        <div class="col-sm-5">
                            <select class="form-control" name="courseId" id="courseIdForModel">
                                #for(course : courseList)
                                <option value="#(course.courseId)">【#escape(course.courseName)】</option>
                                #end
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">难度</label>
                        <div class="col-sm-5">
                            <select class="form-control" name="difficulty" id="difficultyForModel">
                                <option value="3">简单</option>
                                <option value="2">中等</option>
                                <option value="1">困难</option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">提交</button>
                </div>
            </form>
        </div>
    </div>
</div>

#include("_js.html")

<script>

    $(function () {

        search();

        $("form#test-form").submit(function (event) {
            event.preventDefault();
            var form = $(this);
            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: form.serialize(),
                success: function () {
                    $('#testModel').modal('hide');
                    search();
                }
            });

        });

        $('.add-test-btn').click(function () {
            var addUrl = '/testDb/addTest';
            $('#test-form').attr('action', addUrl);
            $('.modal-title').html('新增题目');
            $('#testNameForModel').val('');
            $('#testContentForModel').val('');
            $('#testModel').modal('toggle');
        });

        $('.filter').click(function () {
            var id = $(this).data('id');
            var content = $(this).html();
            var ref = $(this).data('ref');
            var flag = 1;
            $('#' + ref).val(id);
            $('.filter-tag-bar').children().each(function (index, ele) {
                if ($(ele).data('ref') === ref) {
                    $(ele).data('id', id);
                    $(ele).html(content
                        + '<i class="glyphicon glyphicon-remove active-filter-remove" onclick="removeTag(this)"></i>');
                    flag = 0;
                }
            });
            if (flag)
                $('.filter-tag-bar').append('<span class="active-filter-label label label-success" data-ref="' + ref + '">' + content
                    + '<i class="glyphicon glyphicon-remove active-filter-remove" onclick="removeTag(this)"></i></span>');
            search();
        });

        $(".list-search-bar").on("input", function () {
            var content = $(this).val();
            var flag = 1;
            $('#content').val(content);
            $('.filter-tag-bar').children().each(function (index, ele) {
                if ($(ele).data('ref') === 'content') {
                    $(ele).html(content
                        + '<i class="glyphicon glyphicon-remove active-filter-remove" onclick="removeTag(this)"></i>');
                    if (content === '')
                        $(ele).remove();
                    flag = 0;
                }
            });
            if (flag)
                $('.filter-tag-bar').append('<span class="active-filter-label label label-success" data-ref="content">' + content
                    + '<i class="glyphicon glyphicon-remove active-filter-remove" onclick="removeTag(this)"></i></span>');
            search();
        });


    })
    ;

    function removeTag(ele) {
        var ref = $(ele).parent().data('ref');
        if (ref === 'content')
            $(".list-search-bar").val('');
        $('#' + ref).val("-1");
        $(ele).parent().remove();
        search();
    }

    function search() {
        var topicId = $('#topicId').val();
        var courseId = $('#courseId').val();
        var difficulty = $('#difficulty').val();
        var content = $('#content').val();
        var pageCount = parseInt($('#pageCount').val());
        var pageSize = parseInt($('#pageSize').val());
        if ($('#pageCount').val() === undefined || $('#pageSize').val() === '') {
            pageCount = 1;
            pageSize = 20;
        }

        $.post("/testDb/search", {
            pageSize: pageSize,
            pageCount: pageCount,
            courseId: courseId,
            topicId: topicId,
            difficulty: difficulty,
            content: content
        }, function (data) {
            $('#main-table').html(data);

            $('[data-toggle="tooltip"]').tooltip();


            var editUrl = '/testDb/editTest';

            $('.edit-test-btn').click(function () {
                $('#test-form').attr('action', editUrl);
                $('.modal-title').html('修改题目');
                $('#testIdForModel').val($(this).data('id'));
                $('#testNameForModel').val($(this).data('test-name'));
                $('#testContentForModel').val($(this).data('test-content'));
                $('#courseIdForModel').val($(this).data('course-id'));
                $('#topicIdForModel').val($(this).data('topic-id'));
                $('#difficultyForModel').val($(this).data('difficulty'));

                $('#testModel').modal('toggle');
            });

            $('.delete-test-btn').click(function () {
                var btn = $(this);
                layer.confirm('此操作将会删除该问题及其下所有测试用例，是否确认删除？', {
                    btn: ['确认', '取消']
                }, function (index, layero) {
                    layer.close(index);
                    $.get('/testDb/deleteTest?testId=' + btn.data('id'),function (data) {
                        search();
                    });
                }, function (index) {
                    layer.close(index);
                });
            });

            $('.test-content-show').click(function () {
                var that = $(this);
                layer.open({
                    type: 1,
                    skin: 'layui-layer-rim', //加上边框
                    area: ['800px', '400px'], //宽高
                    content: '<pre style="white-space: -moz-pre-wrap; /* Mozilla, supported since 1999 */\n' +
                        '    white-space: -pre-wrap; /* Opera */\n' +
                        '    white-space: -o-pre-wrap; /* Opera */\n' +
                        '    white-space: pre-wrap; /* CSS3 - Text module (Candidate Recommendation) http://www.w3.org/TR/css3-text/#white-space */\n' +
                        '    word-wrap: break-word; /* IE 5.5+ */">' + that.data('content') + '</pre>'
                });
            });

        });


    }
</script>
</body>
</html>